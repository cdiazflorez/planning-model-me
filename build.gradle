plugins {
	id 'org.springframework.boot' version '2.3.1.RELEASE'
	id 'io.spring.dependency-management' version '1.0.9.RELEASE'
	id 'java'
	id 'jacoco'
	id 'checkstyle'
}

group = 'com.mercadolibre'
version = '0.0.1-SNAPSHOT'

sourceCompatibility = 11
targetCompatibility = 11

repositories {
    maven { url "http://maven.artifacts.furycloud.io/repository/all" }
	mavenCentral()
	jcenter()
}

bootJar {
    archiveName 'application.jar'
}

dependencies {
	// Spring
	implementation('org.springframework.boot:spring-boot-starter-web'){
    	exclude module: 'spring-boot-starter-tomcat'
    }
	implementation('org.springframework.boot:spring-boot-starter-jetty')
	
	//Meli Libs
	implementation('com.fury:furyutils:0.0.2')
	implementation('com.mercadolibre.json:json-core:0.0.13')
	implementation('com.mercadolibre.json_jackson:json-jackson:0.0.13')
	implementation('com.mercadolibre.resilience:resilience-core:1.1.0')
	implementation('com.mercadolibre.metrics:metrics-core:0.0.13')
	implementation('com.mercadolibre.metrics:datadog-metric-wrapper:0.0.13')
	implementation('com.mercadolibre:threading:0.1.2')
	implementation('com.mercadolibre:routing:2.1.0')

	//Others
	implementation('com.newrelic.agent.java:newrelic-api:5.13.0')
	implementation('io.springfox:springfox-swagger-ui:2.9.2')
	implementation('io.springfox:springfox-swagger2:2.9.2')

	//Tests
	testImplementation('org.springframework.boot:spring-boot-starter-test')
	testImplementation('org.junit.jupiter:junit-jupiter-api:5.6.2')
	testImplementation('org.junit.jupiter:junit-jupiter-engine:5.6.2')
	testImplementation('org.junit.platform:junit-platform-engine:1.6.2')
	testImplementation('org.junit.platform:junit-platform-launcher:1.6.2')
	testImplementation('org.junit.platform:junit-platform-runner:1.6.2')
 	testImplementation('com.mercadolibre.restclient:restclient-core:0.3.44')
	testImplementation('com.mercadolibre.restclient:restclient-core:0.3.44:tests')
}

tasks.withType(Checkstyle) {
    reports {
        xml.enabled true
        html.enabled false
    }
}

test {
	// Enable JUnit 5 (Gradle 4.6+).
    useJUnitPlatform()

    // Always run tests, even when nothing changed.
    dependsOn 'cleanTest'

    // Show test results.
    testLogging {
        events "passed", "skipped", "failed"
    }
}

jacoco {
    toolVersion = "0.8.5"
    reportsDir = file("$buildDir/reports/jacoco")
}

jacocoTestReport {
    reports {
        xml.enabled true
        html.enabled false
    }
}

checkstyleMain{
    logging.setLevel(LogLevel.LIFECYCLE)
}

checkstyle {
    configFile = rootProject.file('checkstyle_rules.xml')
}

tasks.withType(Checkstyle) {
    reports {
        xml.enabled true
        html.enabled false
    }
}
